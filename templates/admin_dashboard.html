{% extends 'dashboard_layout.html' %}
{% block title %}Dashboard Admin{% endblock %}

{% block dashboard_content %}
    <div id="mainDashboardContent">
    <div class="row g-4">
        <div class="col-md-6 col-lg-3"><div class="stat-card"><div class="icon bg-primary-light"><i class="bi bi-file-earmark-text-fill"></i></div><div><h6 class="text-muted fw-semibold">Total File</h6><h4 class="fw-bold mb-0">{{ stats.total_files }}</h4></div></div></div>
        <div class="col-md-6 col-lg-3"><div class="stat-card"><div class="icon bg-success-light"><i class="bi bi-share-fill"></i></div><div><h6 class="text-muted fw-semibold">Dibagikan</h6><h4 class="fw-bold mb-0">{{ stats.shared_files }}</h4></div></div></div>
        <div class="col-md-6 col-lg-3"><div class="stat-card"><div class="icon bg-danger-light"><i class="bi bi-cloud-download-fill"></i></div><div><h6 class="text-muted fw-semibold">Download</h6><h4 class="fw-bold mb-0">{{ stats.downloads }}</h4></div></div></div>
        <div class="col-md-6 col-lg-3"><div class="stat-card"><div class="icon bg-warning-light"><i class="bi bi-graph-up"></i></div><div><h6 class="text-muted fw-semibold">Aktivitas</h6><h4 class="fw-bold mb-0">{{ stats.activities }}</h4></div></div></div>
    </div>
    <div class="mt-5">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <ul class="nav nav-tabs content-tabs"><li class="nav-item"><a class="nav-link active" id="filesTab" href="#">File Terbaru</a></li><li class="nav-item"><a class="nav-link" id="foldersTab" href="#">Folder</a></li><li class="nav-item"></li></ul>
            <div class="btn-group view-toggle" id="fileViewToggle" role="group"><button type="button" class="btn btn-outline-secondary" id="gridViewBtn"><i class="bi bi-grid-fill"></i></button><button type="button" class="btn btn-outline-secondary active" id="listViewBtn"><i class="bi bi-list-ul"></i></button></div>
        </div>
        <div id="filesContent">
            {% if recent_files %}
                <div id="gridView" style="display: none;"><div class="row g-4">{% for file in recent_files %}<div class="col-md-6 col-lg-3"><div class="file-card"><div class="d-flex align-items-center mb-2"><i class="bi bi-file-earmark-pdf-fill icon text-danger me-2"></i><span class="file-name text-truncate">{{ file.filename }}</span></div><small class="text-muted">{{ file.file_size or 'N/A' }} â€¢ {{ file.timestamp | strftime('%d %b %Y') }}</small></div></div>{% endfor %}</div></div>
                <div id="listView"><div class="list-group">{% for file in recent_files %}<a href="{{ url_for('view_file', filepath=file.file_path) }}" target="_blank" class="list-group-item list-group-item-action"><div class="d-flex w-100 justify-content-between"><h6 class="mb-1 d-flex align-items-center"><i class="bi bi-file-earmark-pdf-fill text-danger me-2"></i>{{ file.filename }}</h6><small class="text-muted">{{ file.timestamp | strftime('%d %b %Y, %H:%M') }}</small></div><p class="mb-1 text-muted small">Diunggah oleh: {{ file.uploader_email }} ke folder: <strong>{{ file.folder }}</strong></p></a>{% endfor %}</div></div>
            {% else %}<div class="text-center p-5 bg-light rounded"><p class="mb-0">Belum ada file.</p></div>{% endif %}
        </div>
        <div id="foldersContent" style="display: none;">
            <div class="row g-3">{% if folders %}{% for folder in folders %}<div class="col-md-6 col-lg-4 col-xl-3"><a href="{{ url_for('view_folder_content', folder_name=folder) }}" class="text-decoration-none"><div class="card shadow-sm h-100 folder-item"><div class="card-body"><h5 class="card-title text-truncate"><i class="bi bi-folder-fill me-2 text-primary"></i>{{ folder }}</h5></div></div></a></div>{% endfor %}{% else %}<div class="col-12"><div class="alert alert-info text-center">Belum ada folder.</div></div>{% endif %}</div>
        </div>
    </div>
</div>
<style>
    /* Menambahkan kursor pointer dan transisi halus untuk animasi */
    .folder-item {
        cursor: pointer;
        transition: all 0.2s ease-in-out;
    }

    /* Animasi hover: item terangkat dan diberi bayangan lembut */
    .folder-item:hover {
        transform: translateY(-4px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        /* z-index diperlukan agar bayangan tidak tertimpa item di bawahnya */
        z-index: 2;
        position: relative;
        color: #007bff; /* Ganti warna teks saat hover */
    }
</style>
    <div id="searchContent" style="display: none;">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div><h1 class="h2 fw-bold mb-0">Cari File Arsip</h1><p class="text-muted mb-0">Masukkan kata kunci untuk mencari file.</p></div>
    </div>
    <div class="card shadow-sm border-0 mb-4">
        <div class="card-body">
            <form method="get" action="{{ url_for('admin_dashboard') }}">
                <input type="hidden" name="show" value="search">
                <div class="input-group mb-3">
                    <input type="text" class="form-control form-control-lg" placeholder="Ketik nama file..." name="query" value="{{ request.args.get('query', '') }}">
                    <button class="btn btn-primary" type="submit"><i class="bi bi-search me-1"></i>Cari & Filter</button>
                </div>
                
                <div class="row g-2">
                    <div class="col-md-3">
                        <select name="letter_type" class="form-select">
                            <option value="all" {% if request.args.get('letter_type', 'all') == 'all' %}selected{% endif %}>Semua Jenis Surat</option>
                            <option value="surat_masuk" {% if request.args.get('letter_type') == 'surat_masuk' %}selected{% endif %}>Surat Masuk</option>
                            <option value="surat_keluar" {% if request.args.get('letter_type') == 'surat_keluar' %}selected{% endif %}>Surat Keluar</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <select name="year" class="form-select">
                            <option value="all" {% if request.args.get('year', 'all') == 'all' %}selected{% endif %}>Semua Tahun</option>
                            {% for year in all_years %}<option value="{{ year }}" {% if request.args.get('year') == year|string %}selected{% endif %}>{{ year }}</option>{% endfor %}
                        </select>
                    </div>
                    <div class="col-md-3">
                        <select name="uploader" class="form-select">
                            <option value="all" {% if request.args.get('uploader', 'all') == 'all' %}selected{% endif %}>Semua Pengunggah</option>
                            {% for uploader in all_uploaders %}<option value="{{ uploader }}" {% if request.args.get('uploader') == uploader %}selected{% endif %}>{{ uploader }}</option>{% endfor %}
                        </select>
                    </div>
                    <div class="col-md-4">
                        <div class="input-group">
                            <select name="sort_by" class="form-select">
                                <option value="timestamp" {% if request.args.get('sort_by', 'timestamp') == 'timestamp' %}selected{% endif %}>Urutkan: Tanggal</option>
                                <option value="filename" {% if request.args.get('sort_by') == 'filename' %}selected{% endif %}>Urutkan: Nama File</option>
                            </select>
                            <select name="sort_order" class="form-select">
                                <option value="desc" {% if request.args.get('sort_order', 'desc') == 'desc' %}selected{% endif %}>Terbaru / Z-A</option>
                                <option value="asc" {% if request.args.get('sort_order') == 'asc' %}selected{% endif %}>Terlama / A-Z</option>
                            </select>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    {% if search_results is not none %}
    <div class="card shadow-sm border-0">
        <div class="card-header">Hasil pencarian untuk: <strong>"{{ search_query }}"</strong></div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-hover align-middle">
                    <thead class="table-dark"><tr><th scope="col">Nama File</th><th scope="col">Jenis Surat</th><th scope="col">Folder</th><th scope="col">Pengunggah</th><th scope="col">Waktu Unggah</th></tr></thead>
                    <tbody>
                        {% if search_results %}{% for file in search_results %}
                        <tr><td>{{ file.filename }}</td><td>{% if file.letter_type == 'surat_masuk' %}<span class="badge bg-primary">Surat Masuk</span>{% elif file.letter_type == 'surat_keluar' %}<span class="badge bg-success">Surat Keluar</span>{% endif %}</td><td>{{ file.folder }}</td><td>{{ file.uploader_email }}</td><td>{{ file.timestamp | strftime('%Y-%m-%d %H:%M:%S') }}</td></tr>
                        {% endfor %}{% else %}<tr><td colspan="5" class="text-center text-muted py-4">Tidak ada file yang cocok.</td></tr>{% endif %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const mainDashboardContent = document.getElementById('mainDashboardContent');
    const searchContent = document.getElementById('searchContent');
    const filesTab = document.getElementById('filesTab');
    const foldersTab = document.getElementById('foldersTab');
    const filesContent = document.getElementById('filesContent');
    const foldersContent = document.getElementById('foldersContent');
    const fileViewToggle = document.getElementById('fileViewToggle');
    const gridViewBtn = document.getElementById('gridViewBtn');
    const listViewBtn = document.getElementById('listViewBtn');
    const gridView = document.getElementById('gridView');
    const listView = document.getElementById('listView');
    
    // Menampilkan konten yang sesuai berdasarkan parameter URL
    const initialView = "{{ show_view }}";
    if (initialView === 'search') {
        mainDashboardContent.style.display = 'none';
        searchContent.style.display = 'block';
    } else {
        mainDashboardContent.style.display = 'block';
        searchContent.style.display = 'none';
    }

    // Logika untuk tab di dasbor utama
    filesTab.addEventListener('click', e => { e.preventDefault(); filesContent.style.display = 'block'; foldersContent.style.display = 'none'; filesTab.classList.add('active'); foldersTab.classList.remove('active'); fileViewToggle.style.display = 'flex'; });
    foldersTab.addEventListener('click', e => { e.preventDefault(); filesContent.style.display = 'none'; foldersContent.style.display = 'block'; foldersTab.classList.add('active'); filesTab.classList.remove('active'); fileViewToggle.style.display = 'none'; });
    
    // Logika untuk tombol grid/list view
    gridViewBtn.addEventListener('click', () => { gridView.style.display = 'block'; listView.style.display = 'none'; gridViewBtn.classList.add('active'); listViewBtn.classList.remove('active'); });
    listViewBtn.addEventListener('click', () => { gridView.style.display = 'none'; listView.style.display = 'block'; listViewBtn.classList.add('active'); gridViewBtn.classList.remove('active'); });
});
</script>
{% endblock %}